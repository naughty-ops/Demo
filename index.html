<!DOCTYPE html>
<html>
<head>
  <title>Student Concession Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />
  <style>
    #map { height: 400px; width: 100%; margin-top: 10px; }
    .btn { padding: 10px; margin: 5px; font-size: 16px; }
  </style>
</head>
<body>

  <h2>ğŸ“ Student Concession Tracker</h2>

  <button class="btn" onclick="locateMe()">ğŸ“ Locate Me</button>
  <button class="btn" onclick="drawRoute()">ğŸ§­ Show Route</button>
  <button class="btn" onclick="startTracking()">ğŸšŒ I'm in the Bus</button>

  <button class="btn" onclick="callHelpline()">ğŸ“ Student Helpline</button>
  <button class="btn" onclick="callControl()">ğŸš¨ Emergency Control Room</button>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([11.0, 76.0], 13); // Default center

    // OpenStreetMap Tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    let userMarker = null;
    let routeLine = null;
    let tracking = false;
    let watchId = null;

    function locateMe() {
      navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        if (userMarker) map.removeLayer(userMarker);
        userMarker = L.marker([lat, lng]).addTo(map).bindPopup("You are here").openPopup();
        map.setView([lat, lng], 16);
      });
    }

    function drawRoute() {
      const start = [11.048, 76.012];  // Example Start (college)
      const end = [11.05, 75.98];      // Example End (home)

      if (routeLine) map.removeLayer(routeLine);
      routeLine = L.polyline([start, end], { color: 'blue', weight: 5 }).addTo(map);

      L.marker(start).addTo(map).bindPopup("Start").openPopup();
      L.marker(end).addTo(map).bindPopup("End");

      map.fitBounds(routeLine.getBounds());
    }

    function startTracking() {
      if (tracking) {
        navigator.geolocation.clearWatch(watchId);
        tracking = false;
        alert("Stopped tracking.");
        return;
      }
      tracking = true;
      watchId = navigator.geolocation.watchPosition((pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        if (userMarker) map.removeLayer(userMarker);
        userMarker = L.marker([lat, lng], {icon: L.icon({iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png', iconSize: [32, 32]})})
          .addTo(map)
          .bindPopup("ğŸšŒ You're on the move")
          .openPopup();
        map.setView([lat, lng]);
      });
    }

    function callHelpline() {
      window.location.href = "tel:+919876543210"; // Replace with real number
    }

    function callControl() {
      window.location.href = "tel:+91112"; // Replace with emergency number
    }
  </script>

</body>
</html>